!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("react"),require("proxy-compare"),require("valtio/vanilla")):"function"==typeof define&&define.amd?define(["exports","react","proxy-compare","valtio/vanilla"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).valtio={},e.React,e.proxyCompare,e.valtioVanilla)}(this,(function(e,n,r,t){"use strict";var u="undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?n.useEffect:n.useLayoutEffect,o=new WeakMap;Object.defineProperty(e,"getVersion",{enumerable:!0,get:function(){return t.getVersion}}),Object.defineProperty(e,"proxy",{enumerable:!0,get:function(){return t.proxy}}),Object.defineProperty(e,"ref",{enumerable:!0,get:function(){return t.ref}}),Object.defineProperty(e,"snapshot",{enumerable:!0,get:function(){return t.snapshot}}),Object.defineProperty(e,"subscribe",{enumerable:!0,get:function(){return t.subscribe}}),Object.defineProperty(e,"unstable_getHandler",{enumerable:!0,get:function(){return t.getHandler}}),e.useSnapshot=function(e,c){var i=n.useReducer((function(e){return e+1}),0)[1],a=new WeakMap,f=n.useRef(),s=n.useRef(),p=n.useRef();u((function(){p.current=s.current=t.snapshot(e)}),[e]),u((function(){f.current=a,s.current!==p.current&&r.isChanged(s.current,p.current,a,new WeakMap)&&(s.current=p.current,i())}));var l,d,b,_,y,g,v,M,S,h=null==c?void 0:c.sync,m=n.useCallback((function(e,n){return t.subscribe(e,(function(){var u=t.snapshot(e);p.current=u;try{if(f.current&&!r.isChanged(s.current,u,f.current,new WeakMap))return}catch(e){}s.current=u,n()}),h)}),[h]),w=(l=function(e){var n,r,u;return o.has(e)||o.set(e,(n=e,r=t.getVersion,(u={})._uMS_T=n,u._uMS_V=r,u)),o.get(e)}(e),d=t.snapshot,b=m,_=n.useRef(),y=l._uMS_V(l._uMS_T),g=n.useState((function(){return[l,d,b,y,d(l._uMS_T)]})),v=g[0],M=g[1],S=v[4],v[0]!==l||v[1]!==d||v[2]!==b?(S=d(l._uMS_T),M([l,d,b,y,S])):y!==v[3]&&y!==_.current&&(S=d(l._uMS_T),Object.is(S,v[4])||M([l,d,b,y,S])),n.useEffect((function(){var e=!1,n=function(){if(!e)try{var n=d(l._uMS_T),r=l._uMS_V(l._uMS_T);_.current=r,M((function(e){return e[0]!==l||e[1]!==d||e[2]!==b||Object.is(e[4],n)?e:[e[0],e[1],e[2],r,n]}))}catch(e){M((function(e){return[].concat(e)}))}},r=b(l._uMS_T,n);return n(),function(){e=!0,r()}}),[l,d,b]),S),j=n.useMemo((function(){return new WeakMap}),[]);return r.createProxy(w,a,j)},Object.defineProperty(e,"__esModule",{value:!0})}));
