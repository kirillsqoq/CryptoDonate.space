!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("proxy-compare")):"function"==typeof define&&define.amd?define(["exports","proxy-compare"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).valtioVanilla={},e.proxyCompare)}(this,(function(e,t){"use strict";var r=Symbol(),n=Symbol(),o=Symbol(),i=Symbol(),c=Symbol(),a=Symbol(),f=new WeakSet;var u=function(e){return"object"==typeof e&&null!==e},s=function(e){return u(e)&&!f.has(e)&&(Array.isArray(e)||!(Symbol.iterator in e))&&!(e instanceof WeakMap)&&!(e instanceof WeakSet)&&!(e instanceof Error)&&!(e instanceof Number)&&!(e instanceof Date)&&!(e instanceof String)&&!(e instanceof RegExp)&&!(e instanceof ArrayBuffer)},l=new WeakMap,d=1,y=new WeakMap;e.getHandler=function(e){return e[i]},e.getVersion=function(e){return u(e)?e[r]:void 0},e.proxy=function e(p){if(void 0===p&&(p={}),!u(p))throw new Error("object required");var v=l.get(p);if(v)return v;var b=d,g=new Set,m=function(e,t){t||(t=++d),b!==t&&(b=t,g.forEach((function(r){return r(e,t)})))},h=new Map,j=function(e){var t=h.get(e);return t||(t=function(t,r){var n=[].concat(t);n[1]=[e].concat(n[1]),m(n,r)},h.set(e,t)),t},O=function(e){var t=h.get(e);return h.delete(e),t},P=Array.isArray(p)?[]:Object.create(Object.getPrototypeOf(p)),w={get:function(e,u,s){return u===r?b:u===n?g:u===o?function(e,r){var i=y.get(r);if((null==i?void 0:i[0])===b)return i[1];var u=Array.isArray(e)?[]:Object.create(Object.getPrototypeOf(e));return t.markToTrack(u,!0),y.set(r,[b,u]),Reflect.ownKeys(e).forEach((function(i){var s=Reflect.get(e,i,r);if(f.has(s))t.markToTrack(s,!1),u[i]=s;else if(s instanceof Promise)if(c in s)u[i]=s[c];else{var l=s[a]||s;Object.defineProperty(u,i,{get:function(){if(c in s)return s[c];throw l}})}else null!=s&&s[n]?u[i]=s[o]:u[i]=s})),Object.freeze(u),u}(e,s):u===i?w:Reflect.get(e,u,s)},deleteProperty:function(e,t){var r=Reflect.get(e,t),o=null==r?void 0:r[n];o&&o.delete(O(t));var i=Reflect.deleteProperty(e,t);return i&&m(["delete",[t],r]),i},is:Object.is,canProxy:s,set:function(r,o,i,f){var s,l,d=Reflect.get(r,o,f);if(this.is(d,i))return!0;var y,p=null==d?void 0:d[n];return p&&p.delete(O(o)),u(i)&&(i=t.getUntracked(i)||i),null!=(s=Object.getOwnPropertyDescriptor(r,o))&&s.set?y=i:i instanceof Promise?y=i.then((function(e){return y[c]=e,m(["resolve",[o],e]),e})).catch((function(e){y[a]=e,m(["reject",[o],e])})):null!=(l=i)&&l[n]?(y=i)[n].add(j(o)):this.canProxy(i)?(y=e(i))[n].add(j(o)):y=i,Reflect.set(r,o,y,f),m(["set",[o],i,d]),!0}},x=new Proxy(P,w);return l.set(p,x),Reflect.ownKeys(p).forEach((function(e){var t=Object.getOwnPropertyDescriptor(p,e);t.get||t.set?Object.defineProperty(P,e,t):x[e]=p[e]})),x},e.ref=function(e){return f.add(e),e},e.snapshot=function(e){return e[o]},e.subscribe=function(e,t,r){var o,i=[],c=function(e){i.push(e),r?t(i.splice(0)):o||(o=Promise.resolve().then((function(){o=void 0,t(i.splice(0))})))};return e[n].add(c),function(){e[n].delete(c)}},Object.defineProperty(e,"__esModule",{value:!0})}));
