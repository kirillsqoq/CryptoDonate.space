"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),r=require("@react-three/fiber"),t=require("three"),n=require("three-stdlib"),s=require("../helpers/environment-assets.cjs.js");function a(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}var u=a(e);const o=e=>{return(r=e).current&&r.current.isScene?e.current:e;var r};function c({children:e,near:n=1,far:s=1e3,resolution:a=256,frames:c=1,background:l=!1,scene:p,files:f,path:d,preset:m,extensions:b}){const g=r.useThree((e=>e.gl)),y=r.useThree((e=>e.scene)),h=u.useRef(null),[v]=u.useState((()=>new t.Scene)),E=u.useMemo((()=>{const e=new t.WebGLCubeRenderTarget(a);return e.texture.type=t.HalfFloatType,e}),[a]);u.useLayoutEffect((()=>{1===c&&h.current.update(g,v);const e=o(p||y),r=e.background,t=e.environment;return"only"!==l&&(e.environment=E.texture),l&&(e.background=E.texture),()=>{e.environment=t,e.background=r}}),[e,p]);let j=1;return r.useFrame((()=>{(c===1/0||j<c)&&(h.current.update(g,v),j++)})),u.createElement(u.Fragment,null,r.createPortal(u.createElement(u.Fragment,null,e,u.createElement("cubeCamera",{ref:h,args:[n,s,E]}),(f||m)&&u.createElement(i,{background:!0,files:f,preset:m,path:d,extensions:b,scene:v})),v))}function i({background:e=!1,files:a=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:c="",preset:i,scene:l,extensions:p}){if(i){if(!(i in s.presetsObj))throw new Error("Preset must be one of: "+Object.keys(s.presetsObj).join(", "));a=s.presetsObj[i],c="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/"}const f=r.useThree((e=>e.scene)),d=Array.isArray(a),m=d?t.CubeTextureLoader:n.RGBELoader,b=r.useLoader(m,d?[a]:a,(e=>{e.setPath(c),null==e.setDataType||e.setDataType(t.FloatType),p&&p(e)})),g=d?b[0]:b;return g.mapping=t.EquirectangularReflectionMapping,u.useLayoutEffect((()=>{const r=o(l||f),t=r.background,n=r.environment;return"only"!==e&&(r.environment=g),e&&(r.background=g),()=>{r.environment=n,r.background=t,g.dispose()}}),[g,e,l]),null}exports.Environment=function(e){return e.children?u.createElement(c,e):u.createElement(i,e)},exports.EnvironmentMap=i,exports.EnvironmentPortal=c;
